<div ng-controller="marks">

	<div class="info-panel">
		<div class="row">
			<div class="col-md-6">
				<div class="form-group">
					<label for="level" class="form-label">
						<i class="bi bi-layers"></i>
						{{labels.level}}
					</label>
					<select id="level" ng-model="level" class="form-select" placeholder="{{labels.level}}" ng-options="level.id as level.name for level in levels | orderBy:'index'" required="required" ng-disabled="submitted" ng-change="updateLevel(true)">
						<option disabled="disabled" value="">اختر {{labels.level}}</option>
					</select>
				</div>
			</div>
			<div class="col-md-6">
				<div class="form-group">
					<label for="course" class="form-label">
						<i class="bi bi-book"></i>
						{{labels.course}}
					</label>
					<select id="course" ng-model="course" class="form-select" placeholder="{{labels.course}}" ng-options="course.id as course.name for course in levelCourses" required="required" ng-disabled="submitted" ng-change="updateCourse()">
						<option disabled="disabled" value="">اختر {{labels.course}}</option>
					</select>
				</div>
			</div>
			<div class="col-md-6">
				<div class="form-group">
					<label for="teacher" class="form-label">
						<i class="bi bi-person-workspace"></i>
						المعلم
					</label>
					<div class="input-group">
						<span class="input-group-text">
							<i class="bi bi-person-check"></i>
							المعلم المسؤول
						</span>
						<input id="teacher" ng-value="teachers[teacher].name" class="form-control" placeholder="المعلم" readonly="readonly" ng-disabled="submitted">
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="list-item-complex list-fade-in" ng-repeat="student in levelStudents | orderBy:'name' track by $index">
		
		<div class="list-item-header">
			<div class="list-title-section">
				<div class="list-item-number">
					<span class="list-item-counter">{{$index + 1}}</span>
				</div>
				<div class="list-item-title">
					<i class="bi bi-person"></i>
					{{student.name}}
				</div>
			</div>
			<div class="list-item-actions" ng-hide="submitted">
				<span class="status-badge status-badge-active" ng-if="marks[student.cpr]['المجموع'] != null">
					المجموع: {{marks[student.cpr]['المجموع']}} / 100
				</span>
				<span class="status-badge status-badge-pending" ng-if="marks[student.cpr]['المجموع'] == null">
					<i class="bi bi-clock"></i>
					لم يتم الإدخال
				</span>
			</div>
		</div>
		
		<div class="list-item-content">
			
			<div class="form-group" ng-repeat="distribution in marksDistribution track by $index">
				<label for="mark_{{student.cpr}}_{{$index}}" class="form-label">
					<i class="bi bi-award"></i>
					{{distribution.title}}
				</label>
				<div class="input-group">
					<span class="input-group-text">
						{{distribution.mark}}
					</span>
					<input id="mark_{{student.cpr}}_{{$index}}" ng-model="marks[student.cpr][distribution.id]" class="form-control" placeholder="{{distribution.title}}" type="number" min="0" max="{{distribution.mark}}" autocomplete="off" placeholder="0" ng-disabled="submitted" ng-change="updateTotal(student)">
				</div>
				<div class="marks-input-help">
					<small class="text-helper">الحد الأقصى: {{distribution.mark}} درجة</small>
				</div>
			</div>
			
			<div class="form-group">
				<label for="mark_{{student.cpr}}_total" class="form-label">
					<i class="bi bi-calculator"></i>
					المجموع الكلي
				</label>
				<div class="input-group">
					<span class="input-group-text">
						100
					</span>
					<input id="mark_{{student.cpr}}_total" ng-model="marks[student.cpr]['المجموع']" class="form-control" placeholder="المجموع الكلي" readonly="readonly" ng-disabled="submitted">
					<span class="input-group-text">
						<i class="bi bi-calculator-fill"></i>
						المجموع
					</span>
				</div>
			</div>
			
			<div class="form-group">
				<label for="mark_{{student.cpr}}_comment" class="form-label">
					<i class="bi bi-chat"></i>
					الملاحظات
				</label>
				<div class="input-group">
					<span class="input-group-text">
						<i class="bi bi-chat"></i>
					</span>
					<input id="mark_{{student.cpr}}_comment" ng-model="marks[student.cpr].comment" class="form-control" placeholder="الملاحظات" ng-disabled="submitted">
					<span class="input-group-text">
						<i class="bi bi-calculator-fill"></i>
						الملاحظات
					</span>
				</div>
			</div>

		</div>

		<div class="list-item-footer">
			<div class="form-controls">
				<div ng-show="student.alert == null">
					<button class="btn btn-action-primary" ng-click="saveStudentCourseMarks(student)" ng-disabled="loading">
						<i class="bi bi-floppy"></i>
						حفظ درجات الطالب
					</button>
					<button class="btn btn-action-primary" ng-click="deleteStudentCourseMarks(student)" ng-disabled="loading">
						<i class="bi bi-x-lg"></i>
						إعادة الدرجات
					</button>
				</div>
				<div class="alert alert-success alert-custom d-flex align-items-center" ng-hide="student.alert == null">
					<i class="bi bi-check-circle-fill"></i>
					{{student.alert}}
				</div>
			</div>
		</div>
		
	</div>
</div>