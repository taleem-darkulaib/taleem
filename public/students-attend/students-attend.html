<div ng-controller="students-attend">

	<div class="info-panel">
		<div class="row">
			<div class="col-md-6">
				<div class="form-group">
					<label for="date" class="form-label">
						<i class="bi bi-calendar-check"></i>
						تاريخ الحصة
					</label>
					<div class="input-group date-navigation">
						<button class="btn-action-secondary date-nav-btn" ng-click="nextDate()" ng-hide="submitted" title="اليوم التالي">
							<i class="bi bi-chevron-double-down"></i>
						</button>
						<select id="date" ng-model="date" class="form-select" placeholder="تاريخ الحصة" ng-options="date for date in dates" required="required" ng-disabled="submitted" ng-change="updateDate()">
							<option disabled="disabled" value="">اختر التاريخ</option>
						</select>
						<button class="btn-action-secondary date-nav-btn" ng-click="previousDate()" ng-hide="submitted" title="اليوم السابق">
							<i class="bi bi-chevron-double-up"></i>
						</button>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="form-group">
					<label for="night" class="form-label">
						<i class="bi bi-sun"></i>
						اليوم
					</label>
					<div class="input-group">
						<span class="input-group-text">
							<i class="bi bi-sun"></i>
						</span>
						<input id="night" ng-value="nights[night].name" class="form-control" placeholder="اليوم" readonly="readonly">
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-4">
				<div class="form-group">
					<label for="level" class="form-label">
						<i class="bi bi-layers"></i>
						{{labels.level}}
					</label>
					<select id="level" ng-model="level" class="form-select" placeholder="{{labels.level}}" ng-options="level.id as level.name for level in levels | orderBy : 'index'" required="required" ng-disabled="submitted" ng-change="updateLevel(true)">
						<option disabled="disabled" value="">اختر {{labels.level}}</option>
					</select>
				</div>
			</div>
			
			<div class="col-md-4">
				<div class="form-group">
					<label for="course" class="form-label">
						<i class="bi bi-book"></i>
						{{labels.course}}
					</label>
					<select id="course" ng-model="course" class="form-select" placeholder="{{labels.course}}" ng-options="course.id as course.name for course in levelCourses | orderBy : 'index'" required="required" ng-disabled="submitted" ng-change="updateCourse()">
						<option value="">اختر {{labels.course}}</option>
					</select>
				</div>
			</div>
			
			<div class="col-md-4">
				<div class="form-group">
					<label for="teacher" class="form-label">
						<i class="bi bi-person-badge"></i>
						المعلم
					</label>
					<div class="input-group">
						<span class="input-group-text">
							<i class="bi bi-person-badge"></i>
						</span>
						<input id="teacher" ng-value="teachers[teacher].name" class="form-control teacher-input" placeholder="المعلم" readonly="readonly">
					</div>
				</div>
			</div>
		</div>
		
		<div class="help-text-enhanced">
			<small>
				<i class="bi bi-info-circle"></i>
				يرجى اختيار التاريخ و{{labels.level}} و{{labels.course}} لبدء تسجيل الحضور
			</small>
		</div>
		
	</div>
	
	<div class="card" ng-if="teacher != null">
		<div class="card-header">
			حضور المعلم: {{teachers[teacher].name}}
		</div>
		<div class="card-body">
			<div class="btn-group" role="group">
				<input id="notify_teacher" name="teacherAttend" ng-model="teacherAttend.status" type="radio" value="معتذر" class="btn-check" ng-change="updateTeacherAttend()" ng-click="clickTeacherAttend('معتذر')">
				<label for="notify_teacher" class="btn attend-btn">
					معتذر
					<i class="bi bi-clock me-1"></i>
				</label>
				
				<input id="late_teacher" name="teacherAttend" ng-model="teacherAttend.status" type="radio" value="متأخر" class="btn-check" ng-change="updateTeacherAttend()" ng-click="clickTeacherAttend('متأخر')">
				<label for="late_teacher" class="btn attend-btn">
					متأخر
					<i class="bi bi-stopwatch me-1"></i>
				</label>
				
				<input id="absent_teacher" name="teacherAttend" ng-model="teacherAttend.status" type="radio" value="غائب" class="btn-check" ng-change="updateTeacherAttend()" ng-click="clickTeacherAttend('غائب')">
				<label for="absent_teacher" class="btn attend-btn">
					غائب
					<i class="bi bi-x-circle me-1"></i>
				</label>
				
				<input id="attend_teacher" name="teacherAttend" ng-model="teacherAttend.status" type="radio" value="حاضر" class="btn-check" ng-change="updateTeacherAttend()" ng-click="clickTeacherAttend('حاضر')">
				<label for="attend_teacher" class="btn attend-btn">
					حاضر
					<i class="bi bi-check-circle me-1"></i>
				</label>
			</div>
			<input class="form-control" ng-model="teacherAttend.comment" type="text" placeholder="ملاحظات على حضور المعلم..." ng-blur="updateTeacherAttend()">
		</div>
	</div>
	
	<div class="d-flex justify-content-between align-items-center my-4" ng-if="level != null && course != null">
		<h3>قائمة الطلبة</h3>
		<button class="btn btn-add" ng-click="attendAll()" ng-hide="submitted">
			<i class="bi bi-check-circle"></i>
			حضور الكل
		</button>
	</div>
	
	<div class="list-item-complex list-fade-in" ng-repeat="student in levelStudents | orderBy : 'name' track by $index" ng-if="level != null && course != null">
		
		<div class="list-item-header">
			<div class="list-title-section">
				<div class="list-item-number">
					<div class="list-item-counter">{{$index + 1}}</div>
					<div class="list-item-title">
						<i class="bi bi-person list-icon-md"></i>
						{{student.name}}
					</div>
				</div>
			</div>
			<div class="list-item-actions">
				<div class="student-status" ng-if="attendance[student.cpr].status">
					<span class="status-badge" ng-class="{
						'status-badge-excuse': attendance[student.cpr].status == 'معتذر',
						'status-badge-late': attendance[student.cpr].status == 'متأخر',
						'status-badge-absent': attendance[student.cpr].status == 'غائب',
						'status-badge-present': attendance[student.cpr].status == 'حاضر'}">
						<i class="bi ms-1" ng-class="{
						'bi-check-circle-fill': attendance[student.cpr].status == 'حاضر',
						'bi-stopwatch-fill': attendance[student.cpr].status == 'متأخر',
						'bi-clock-fill': attendance[student.cpr].status == 'معتذر',
						'bi-x-circle-fill': attendance[student.cpr].status == 'غائب'}"></i>
						{{attendance[student.cpr].status}}
					</span>
				</div>
			</div>
		</div>
		
		<div class="list-item-content">
		
			<div class="btn-group" role="group">
				<input id="notify{{student.cpr}}" name="status{{student.cpr}}" ng-model="attendance[student.cpr].status" type="radio" value="معتذر" class="btn-check" ng-change="updateStudentAttend(student)" ng-click="clickStudentAttend(student, 'معتذر')">
				<label for="notify{{student.cpr}}" class="btn attend-btn">
					
					معتذر
					<i class="bi bi-clock me-1"></i>
				</label>
				
				<input id="late{{student.cpr}}" name="status{{student.cpr}}" ng-model="attendance[student.cpr].status" type="radio" value="متأخر" class="btn-check" ng-change="updateStudentAttend(student)" ng-click="clickStudentAttend(student, 'متأخر')">
				<label for="late{{student.cpr}}" class="btn attend-btn">
					
					متأخر
					<i class="bi bi-stopwatch me-1"></i>
				</label>
				
				<input id="absent{{student.cpr}}" name="status{{student.cpr}}" ng-model="attendance[student.cpr].status" type="radio" value="غائب" class="btn-check" ng-change="updateStudentAttend(student)" ng-click="clickStudentAttend(student, 'غائب')">
				<label for="absent{{student.cpr}}" class="btn attend-btn">
					
					غائب
					<i class="bi bi-x-circle me-1"></i>
				</label>
				
				<input id="attend{{student.cpr}}" name="status{{student.cpr}}" ng-model="attendance[student.cpr].status" type="radio" value="حاضر" class="btn-check" ng-change="updateStudentAttend(student)" ng-click="clickStudentAttend(student, 'حاضر')">
				<label for="attend{{student.cpr}}" class="btn attend-btn">
					حاضر
					<i class="bi bi-check-circl me-1"></i>
				</label>
			</div>
			
			<div class="input-group">
				<button type="button" class="btn btn-action-warning" ng-click="sendWhatsappMessage(student)" ng-show="isStringNotEmpty(config.textMeBot) && isStringNotEmpty(config.absentLetter) && attendance[student.cpr].status == 'غائب' && attendance[student.cpr].notification == null">
					<i class="bi bi-whatsapp"></i>
					إرسال
				</button>
				<button type="button" class="btn btn-action-warning" ng-click="sendWhatsappMessage(student)" ng-show="isStringNotEmpty(config.textMeBot) && isStringNotEmpty(config.lateLetter) && attendance[student.cpr].status == 'متأخر' && attendance[student.cpr].notification == null">
					<i class="bi bi-whatsapp"></i>
					إرسال
				</button>
				<label class="btn btn-action-primary" ng-show="attendance[student.cpr].notification">
					<i class="bi bi-send"></i>
					تم الارسال
				</label>
				<input class="form-control" ng-model="attendance[student.cpr].comment" maxlength="100" type="text" placeholder="ملاحظات على حضور الطالب..." ng-blur="updateStudentAttend(student)">
			</div>
		</div>
		
	</div>

</div>