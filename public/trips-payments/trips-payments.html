<div ng-controller="trips-payments">

	<div class="info-panel">
		<div class="row">
			<div class="col-md-6">
				<div class="form-group">
					<label class="form-label">
						<i class="bi bi-airplane-fill"></i>
						الرحلة
					</label>
					<select id="trip" ng-model="trip" class="form-select" placeholder="الرحلة" ng-options="trip.id as trip.name for trip in trips" required="required" ng-disabled="submitted" ng-change="updateTrip(true)">
						<option disabled="disabled" value="">اختر الرحلة</option>
					</select>
				</div>
			</div>
			<div class="col-md-6">
				<div class="form-group">
					<label class="form-label">
						<i class="bi bi-layers"></i>
						{{labels.level}}
					</label>
					<select id="level" ng-model="level" class="form-select" placeholder="{{labels.level}}" ng-options="level.id as level.name for level in tripLevels" required="required" ng-disabled="submitted" ng-change="updateLevel()">
						<option disabled="disabled" value="">اختر {{labels.level}}</option>
					</select>
				</div>
			</div>
		</div>
		<div class="help-text-enhanced">
			<small>
				<i class="bi bi-info-circle"></i>
				يرجى اختيار الرحلة ثم {{labels.level}} لتسجيل المدفوعات
			</small>
		</div>
	</div>
	
	<div class="info-panel info-panel-success">
		<h5>
			<i class="bi bi-cash-coin"></i>
			بيانات دفع الرحلة
		</h5>
		<div class="row">
			<div class="col-md-6">
				<div class="form-group">
					<label class="form-label">
						<i class="bi bi-person-check-fill"></i>
						المستلم
					</label>
					<input id="receiver" ng-model="receiver" type="text" class="form-control name" placeholder="اسم مستلم رسوم الرحلة" maxlength="100" autocomplete="off" ng-disabled="submitted" ng-change="updateReceiver()">
				</div>
			</div>
			<div class="col-md-6">
				<div class="form-group">
					<label class="form-label">
						<i class="bi bi-currency-dollar"></i>
						رسوم الرحلة
					</label>
					<input id="fees" ng-model="fees" class="form-control fees" type="tel" placeholder="مبلغ رسوم الرحلة" maxlength="3" required="required" autocomplete="off" ng-disabled="submitted">
				</div>
			</div>
		</div>
	</div>
	
	<div class="card">
		<div class="card-header d-flex justify-content-between align-items-center">
			<div>
				<i class="bi bi-people"></i>
				قائمة الطلبة
			</div>
		</div>
		
		<div id="students" class="accordion">
			
			<div class="card-body">
			
				<div class="payment-item" ng-repeat="student in tripStudents | orderBy : 'name' track by $index">
					
					<div id="student{{$index}}head" class="payment-item-header" ng-class="getPaymentHeaderClass(student)">
						<button class="payment-toggle-btn w-100" type="button" data-bs-toggle="collapse" data-bs-target="#student{{$index}}" aria-expanded="false" aria-controls="student{{$index}}">
							<div class="d-flex justify-content-between align-items-center">
								<div class="student-info">
									<div class="counter-badge">{{$index + 1}}</div>
									<i class="bi bi-person-fill"></i>
									{{student.name}}
								</div>
								<div class="payment-status">
									<span class="status-badge status-badge-active ms-2" ng-show="payments[student.cpr].selected">
										<i class="bi bi-check-circle-fill"></i>
										تم الدفع
									</span>
									<span class="status-badge status-badge-inactive ms-2" ng-hide="payments[student.cpr].selected">
										<i class="bi bi-clock-fill"></i>
										لم يدفع
									</span>
									<i class="bi bi-chevron-down ms-3"></i>
								</div>
							</div>
						</button>
					</div>
					
					<div id="student{{$index}}" class="collapse" aria-labelledby="student{{$index}}head" data-bs-parent="#students">
						<div class="payment-item-content">
							<div class="payment-toggle-section">
								<div class="input-group payment-input-group">
									<label for="payments{{student.cpr}}" class="input-group-text">
										<div class="form-check form-switch">
											<input id="payments{{student.cpr}}" ng-model="payments[student.cpr].selected" type="checkbox" class="form-check-input form-check-input-lg" ng-value="true" ng-true-value="true" ng-false-value="false" ng-disabled="submitted" ng-change="updateStudentPayment(student)">
										</div>
									</label>
									
									<label for="payments{{student.cpr}}" class="form-control">إتمام عملية الدفع</label>
									
									<label for="payments{{student.cpr}}" class="status-badge status-badge-active" ng-show="payments[student.cpr] != null && payments[student.cpr].selected">
										<i class="bi bi-check-circle-fill"></i>
										مدفوع
									</label>
									<label for="payments{{student.cpr}}" class="status-badge status-badge-inactive" ng-hide="payments[student.cpr] != null && payments[student.cpr].selected">
										<i class="bi bi-x-circle-fill"></i>
										غير مدفوع
									</label>
								</div>
							</div>
							
							<div class="payment-info-section mt-3" ng-show="payments[student.cpr] != null && payments[student.cpr].selected">
								<div class="row">
									<div class="col-md-6">
										<div class="info-panel info-panel-success">
											<i class="bi bi-calendar-check me-2"></i>
											<strong>تاريخ الدفع:</strong> {{payments[student.cpr].time}}
										</div>
									</div>
									<div class="col-md-6">
										<div class="info-panel info-panel-success">
											<i class="bi bi-cash me-2"></i>
											<strong>المبلغ:</strong> {{fees}} د.ب
										</div>
									</div>
									<div class="col-md-6" ng-show="receiver">
										<div class="info-panel">
											<i class="bi bi-person-check me-2"></i>
											<strong>المستلم:</strong> {{receiver}}
										</div>
									</div>
								</div>
							</div>
							
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
</div>